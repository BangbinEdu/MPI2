<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duel Cerdas: Pancasila (Full Offline)</title>
    
    <link rel="stylesheet" href="bangbinasset/bangbinstyle/fontawesome/css/all.min.css">

    <style>
        @font-face {
            font-family: 'Fredoka One';
            src: url('bangbinasset/bangbinstyle/FredokaOne-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Open Sans';
            src: url('bangbinasset/bangbinstyle/OpenSans-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Open Sans';
            src: url('bangbinasset/bangbinstyle/OpenSans-Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(to right top, #6DD5FA, #FF758C);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            text-align: center;
            position: relative;
            overflow-y: auto;
            padding: 20px 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            z-index: 10000; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease-out, visibility 0.8s;
            overflow: hidden; 
        }

        #welcome-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .welcome-content {
            text-align: center;
            color: white;
            animation: zoomIn 0.5s ease-out;
            width: 100%; 
        }

        .welcome-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0px #333;
            letter-spacing: 2px;
        }

        .welcome-images {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            align-items: flex-end;
            position: relative;
            min-height: 200px; 
        }

        .welcome-char {
            height: 400px;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
        }

        .slide-in-left {
            animation: slideInFromLeft 3s ease-out forwards;
        }

        .slide-in-right {
            animation: slideInFromRight 3s ease-out forwards;
        }

        .bounce-active {
            animation: bounceChar 3s infinite ease-in-out;
        }
        
        .welcome-char:nth-child(2).bounce-active {
            animation-delay: 0.5s; 
        }


        .flash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: radial-gradient(circle at 50% 45%, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 5%, rgba(255,255,255,0.6) 12%, rgba(255,255,255,0) 30%);
            opacity: 0;
            transform: scale(1);
            transition: opacity 0.25s ease-out, transform 0.4s ease-out;
            z-index: 10005;
            mix-blend-mode: screen;
        }

        .flash-overlay.show {
            opacity: 1;
            transform: scale(1.02);
        }

        .welcome-char.glow {
            filter: drop-shadow(0 0 30px rgba(255,255,220,0.95)) saturate(140%);
            transform: translateY(-6px) scale(1.02);
            transition: transform 0.25s ease, filter 0.35s ease;
        }

        @keyframes slideInFromLeft {
            0% { transform: translateX(-120vw); opacity: 0; }
            70% { transform: translateX(20px); opacity: 1; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInFromRight {
            0% { transform: translateX(120vw); opacity: 0; }
            70% { transform: translateX(-20px); opacity: 1; } 
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes bounceChar {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .countdown-circle {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Fredoka One', cursive;
            font-size: 4em;
            color: #fff;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: pulseCount 1s infinite;
            white-space: nowrap;
        }

        @keyframes pulseCount {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #34495E;
            color: white;
            border: none;
            box-shadow: 0 4px #2C3E50;
            cursor: pointer;
            z-index: 9999; 
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.1s;
            outline: none;
        }
        
        #fullscreen-btn:hover {
            background-color: #2C3E50;
        }

        #fullscreen-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px #2C3E50;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            animation: bubble-float 15s infinite ease-in-out;
            opacity: 0;
            z-index: 0;
        }
        .bubble:nth-child(1) { width: 60px; height: 60px; left: 10%; animation-duration: 12s; animation-delay: 0s; }
        .bubble:nth-child(2) { width: 80px; height: 80px; left: 30%; animation-duration: 15s; animation-delay: 2s; }
        .bubble:nth-child(3) { width: 50px; height: 50px; left: 50%; animation-duration: 10s; animation-delay: 1s; }
        .bubble:nth-child(4) { width: 70px; height: 70px; left: 70%; animation-duration: 13s; animation-delay: 3s; }
        .bubble:nth-child(5) { width: 90px; height: 90px; left: 90%; animation-duration: 16s; animation-delay: 4s; }
        .bubble:nth-child(6) { width: 65px; height: 65px; left: 20%; animation-duration: 11s; animation-delay: 0.5s; }
        .bubble:nth-child(7) { width: 75px; height: 75px; left: 45%; animation-duration: 14s; animation-delay: 2.5s; }

        @keyframes bubble-float {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
        }

        .screen {
            display: none;
            width: 90%;
            max-width: 3000px;
            padding: 30px; 
            background-color: #ffffff;
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            position: relative;
            z-index: 2;
            animation: fade-in 0.8s ease-out; 
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .screen.active {
            display: block;
        }

        h1, h2 {
            font-family: 'Fredoka One', cursive; 
            color: #E74C3C; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        #main-screen {
            background: linear-gradient(to bottom right, #FFD166, #FF9B71);
            color: #fff;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 50vh; 
            width: 95%; 
            max-width: 1200px; 
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #main-screen h1 {
            font-size: 3.5em; 
            color: #fff;
            margin-bottom: 40px;
        }

        /* Updated Button Container for 4 buttons */
        .button-container {
            display: grid; 
            grid-template-columns: repeat(4, 1fr); /* Now 4 columns for desktop */
            gap: 20px; 
            margin-top: 40px;
            width: 100%;
            max-width: 900px;
            z-index: 10; /* Ensure buttons are above images */
            position: relative;
        }

        .btn-3d {
            background-color: #2ECC71; 
            color: white;
            padding: 18px 20px; 
            border: none;
            border-radius: 15px; 
            cursor: pointer;
            font-size: 18px; 
            font-weight: bold;
            box-shadow: 0 9px #27AE60; 
            transition: all 0.15s ease; 
            position: relative;
            outline: none; 
            font-family: 'Fredoka One', cursive;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-3d:hover {
            background-color: #27AE60; 
        }

        .btn-3d:active {
            box-shadow: 0 4px #27AE60; 
            transform: translateY(5px); 
        }

        /* Warna khusus untuk tombol */
        #btn-tujuan { background-color: #3498DB; box-shadow: 0 9px #2980B9; }
        #btn-tujuan:hover { background-color: #2980B9; }
        #btn-tujuan:active { box-shadow: 0 4px #2980B9; transform: translateY(5px); }

        #btn-petunjuk { background-color: #E67E22; box-shadow: 0 9px #D35400; }
        #btn-petunjuk:hover { background-color: #D35400; }
        #btn-petunjuk:active { box-shadow: 0 4px #D35400; transform: translateY(5px); }

        #btn-profil { background-color: #9B59B6; box-shadow: 0 9px #8E44AD; }
        #btn-profil:hover { background-color: #8E44AD; }
        #btn-profil:active { box-shadow: 0 4px #8E44AD; transform: translateY(5px); }

        /* New Button Hak Cipta */
        #btn-hakcipta { background-color: #E74C3C; box-shadow: 0 9px #C0392B; }
        #btn-hakcipta:hover { background-color: #C0392B; }
        #btn-hakcipta:active { box-shadow: 0 4px #C0392B; transform: translateY(5px); }

        #btn-mulai { background-color: #F1C40F; color: #333; box-shadow: 0 9px #F39C12; margin-top: 25px; max-width: 300px; font-size: 24px; z-index: 10; position: relative;}
        #btn-mulai:hover { background-color: #F39C12; }
        #btn-mulai:active { box-shadow: 0 4px #F39C12; transform: translateY(5px); }


        .main-screen-char {
            position: absolute;
            bottom: -20px;
            height: 60vh;       
            max-height: 450px;   
            min-height: 250px;
            width: auto;       
            max-width: 40vw;
            
            z-index: 3;
            transition: transform 0.3s ease;
            pointer-events: none; 
        }
        
        .char-left {
            left: 20px; 
        }
        .char-right {
            right: 20px;
        }

        .info-screen {
            display: none; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            z-index: 100; 
            justify-content: center;
            align-items: center;
            opacity: 0; 
            transition: opacity 0.3s ease-out; 
        }

        .info-screen.show {
            display: flex; 
            opacity: 1; 
        }

        .info-content {
            background: linear-gradient(to bottom right, #e0f2f7, #bbdefb); 
            padding: 40px; 
            border-radius: 25px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.3); 
            width: 85%; 
            max-width: 650px; 
            position: relative;
            text-align: left; 
            transform: scale(0.8); 
            opacity: 0; 
            transition: transform 0.3s ease-out, opacity 0.3s ease-out; 
            max-height: 90vh;
            overflow-y: auto;
        }

        .info-screen.show .info-content {
            transform: scale(1); 
            opacity: 1; 
        }

        .info-content h2 {
            font-family: 'Fredoka One', cursive; 
            color: #2C3E50; 
            margin-bottom: 25px; 
            font-size: 2.2em; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            text-align: center;
        }

        .info-content p, .info-content ul, .info-content ol {
            text-align: justify; 
            line-height: 1.8; 
            color: #444; 
            font-size: 1.1em; 
            margin-bottom: 15px; 
        }
        .info-content ul, .info-content ol {
            margin-left: 25px; 
        }
        .info-content ul li, .info-content ol li {
            margin-bottom: 8px; 
        }

        .clickable-list-item {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            padding: 5px;
            border-radius: 5px;
        }
        .clickable-list-item:hover {
            background-color: rgba(255, 255, 255, 0.7); 
        }
         .clickable-list-item:active {
            transform: scale(0.98); 
        }


        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 35px; 
            font-weight: bold;
            color: #d35400; 
            cursor: pointer;
            transition: transform 0.2s ease-in-out, color 0.2s ease-in-out; 
            border-radius: 50%; 
            padding: 0 5px;
            line-height: 1; 
            z-index: 10;
        }
        .close-btn:hover {
            color: #e74c3c; 
            transform: rotate(90deg); 
        }

        /* Tombol "Dengarkan Penjelasan" di modal sila */
        #play-ket-btn {
            background-color: #1abc9c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            font-weight: bold;
            box-shadow: 0 4px #16a085;
            transition: all 0.15s ease;
        }
        #play-ket-btn:hover {
            background-color: #16a085;
        }
        #play-ket-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px #16a085;
        }

        .home-button {
            background-color: #3498DB;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: background-color 0.3s;
            box-shadow: 0 4px #2980B9;
        }
        .home-button:hover {
            background-color: #2980B9;
        }
        .home-button:active {
            box-shadow: 0 2px #2980B9;
            transform: translateY(2px);
        }

        #introduction-screen {
            text-align: left;
            max-width: 1600px;
        }

        #introduction-screen h1 {
            text-align: center;
        }

        .materi-container {
            margin-top: 20px;
            line-height: 1.6;
        }

        .materi-container h2 {
            font-size: 1.5em;
            color: #3498DB;
            border-bottom: 2px solid #3498DB;
            padding-bottom: 5px;
            margin-top: 25px;
            margin-bottom: 20px; 
            text-align: center; 
        }
        
        .sila-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 20px;
            padding: 10px;
            justify-items: center;
        }
        
        .sila-card {
            background-color: #f0f8ff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid #3498DB;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            width: 100%;
            max-width: 150px;
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .sila-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.4);
        }

        .sila-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .sila-card .sila-img {
            width: 70px; 
            height: 70px; 
            margin-bottom: 10px;
        }
        
        .sila-card span {
            font-family: 'Fredoka One', cursive;
            font-size: 1.1em;
            color: #2980B9;
        }


        #introduction-screen #start-game-btn {
            background-color: #007bff;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            box-shadow: 0 6px #0056b3;
            margin-top: 30px;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        #introduction-screen #start-game-btn:hover {
            background-color: #0056b3;
        }
        #introduction-screen #start-game-btn:active {
            box-shadow: 0 3px #0056b3;
            transform: translateY(3px);
        }
        #introduction-screen .button-wrapper {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .game-header {
            margin-bottom: 20px;
        }
        .timer-container {
            font-size: 1.8em;
            font-weight: bold;
            color: #d9534f;
            margin-bottom: 15px;
            background-color: #ffe0e0;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }
        .players-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            flex-wrap: wrap; 
        }
        .player-area {
            flex: 1; 
            min-width: 300px;
            max-width: 45%;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #eee;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .game-content {
            min-height: 250px; 
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .player-score {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 15px;
            color: #28a745;
        }

		/* --- Level 1 Styles --- */
		.mc-question {
			font-size: 1.2em;
			margin-bottom: 20px;
		}
        .mc-question .sila-img {
            width: 100px; 
            height: 100px; 
        }
		.mc-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            gap: 10px;
            width: 100%;
            max-width: 500px; 
            margin: 0 auto;
        }
        .mc-options button {
			display: block;
			width: 100%; 
			margin: 0; 
			background-color: #007bff;
            color: white;
			padding: 12px 10px; 
			font-size: 1.1em; 
            font-weight: bold;
			border-radius: 8px;
			box-shadow: 0 4px #0056b3;
			transition: all 0.1s ease;
		}
		.mc-options button:hover {
			background-color: #0056b3;
		}
		.mc-options button:active {
			box-shadow: 0 2px #0056b3;
			transform: translateY(2px);
		}


        /* --- Level 2 Styles --- */
        .draggable-item {
            cursor: grab;
            display: inline-block; 
            margin: 5px;
            padding: 5px;
            background-color: #f4f4f4;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: transform 0.1s;
        }
        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        .draggable-item.dragging {
            opacity: 0.5;
        }
        
        .draggable-item .sila-img {
            width: 40px;  
            height: 40px; 
            pointer-events: none; 
            display: block; 
        }

        .items-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 10px;
            min-height: 60px; 
        }
        
        .draggable-item img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            pointer-events: none; 
        }
        .drop-zones-container {
            display: grid; 
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 600px;
            margin: 15px auto 0 auto;
        }
        .drop-zone {
            flex: 1;
            padding: 15px;
            border: 3px dashed #aaa;
            border-radius: 15px;
            min-height: 100px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            gap: 8px;
            transition: all 0.2s ease;
        }
        .drop-zone h3 {
            margin: 0;
            color: #555;
            pointer-events: none;
            font-size: 1em; 
            font-family: 'Fredoka One', cursive;
        }
        .drop-zone.drag-over {
            background-color: #d4edda;
            border-color: #28a745;
        }
        .drop-zone .dropped-icon {
            width: auto;
            height: auto;
        }
        .drop-zone .dropped-icon .sila-img {
            width: 50px;
            height: 50px;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }


        /* --- Level 3 Styles --- */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            gap: 10px;
            justify-content: center;
            width: 100%;
            max-width: 600px; 
        }
        .memory-card {
            width: 100%; 
            aspect-ratio: 1 / 1; 
            height: auto; 
            background-color: #3498db;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            box-shadow: 0 4px #2980B9;
        }
        .memory-card.flip {
            transform: rotateY(180deg);
            box-shadow: 0 0px #2980B9; 
        }
        .memory-card .front-face, .memory-card .back-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 1.5em;
            color: #fff;
            font-weight: bold;
        }
        .memory-card .front-face {
            background: #f1c40f;
            transform: rotateY(180deg);
            padding: 5px;
            box-sizing: border-box;
            font-size: 0.9em; 
            line-height: 1.2;
            text-align: center;
            color: #333; 
        }
        .memory-card .front-face .sila-img {
            width: 60px; 
            height: 60px; 
        }
        .memory-card .back-face {
            background-color: #3498db;
        }
        .memory-card img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        /* --- Level 4: Puzzle Game (Drag and Drop) --- */
        .puzzle-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .puzzle-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            width: 240px; 
            height: 240px;
            background-color: #ddd;
            border: 3px solid #2C3E50;
            padding: 2px;
            border-radius: 5px;
        }

        .puzzle-slot {
            background-color: #fff;
            border: 1px dashed #aaa;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .puzzle-slot.drag-over {
            background-color: #d4edda;
            border-color: #28a745;
        }

        .puzzle-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 10px;
            background-color: #e0f2f7;
            border-radius: 10px;
            min-height: 80px;
            width: 100%;
            max-width: 350px;
            border: 2px dashed #3498DB;
        }
        
        .puzzle-piece-draggable {
            width: 78px; 
            height: 78px;
            cursor: grab;
            background-size: 300% 300%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        .puzzle-piece-draggable:active {
            cursor: grabbing;
            transform: scale(1.05);
        }
        
        .puzzle-piece-draggable.dragging {
            opacity: 0.5;
        }

        .puzzle-reference {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #555;
        }
        
        .puzzle-reference img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border: 2px solid #3498DB;
            border-radius: 5px;
            padding: 2px;
            background: #fff;
            vertical-align: middle;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 101; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            animation: zoom-in 0.3s ease-out;
        }
        @keyframes zoom-in {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-content h2 {
            color: #2C3E50;
            margin-bottom: 15px;
        }
        .modal-content button {
            background-color: #28a745;
            color: white;
            box-shadow: 0 6px #218838;
            margin-top: 25px;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 10px;
            border: none;
            cursor: pointer;
        }
        .modal-content button:hover {
            background-color: #218838;
        }
        .modal-content button:active {
            box-shadow: 0 3px #218838;
            transform: translateY(3px);
        }

        /* Final Screen */
        #final-screen {
            background: linear-gradient(to right, #D4FC79, #96E6A1);
            padding: 50px;
            color: #333;
        }
        #final-screen h1 {
            color: #2C3E50;
            font-size: 3em;
        }
        #final-scores {
            font-size: 1.6em;
            margin: 25px 0;
            line-height: 1.8;
            font-weight: bold;
        }
        #overall-winner {
            font-size: 2.5em;
            color: #28a745;
            margin-top: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        #final-screen button {
            background-color: #FF6B6B;
            color: white;
            box-shadow: 0 6px #EE5253;
            padding: 15px 35px;
            font-size: 1.3em;
            border-radius: 10px;
            border: none;
            cursor: pointer;
        }
        #final-screen button:hover {
            background-color: #EE5253;
        }
        #final-screen button:active {
            box-shadow: 0 3px #EE5253;
            transform: translateY(3px);
        }

        .falling-element {
            position: fixed;
            top: -10%;
            z-index: 1;
            user-select: none;
            pointer-events: none;
            animation: fall linear forwards;
        }
        .falling-element .sila-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
            }
        }

        /* =========================================
           HAK CIPTA NEW STYLES
           ========================================= */
        .hak-cipta-container {
            font-family: 'Open Sans', sans-serif; 
            position: relative;
            color: #000;
            text-align: center;
            overflow: hidden; 
            padding: 20px 40px; 
        }

        .hc-logo-top {
            width: 80px; 
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .hc-header h2, .hc-header h3, .hc-header h4 {
            margin: 5px 0;
            font-family: 'Open Sans', sans-serif; /* Strict normal font for header */
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
            text-shadow: none;
            line-height: 1.2;
        }

        .hc-header h2 { font-size: 1.1em; }
        .hc-header h3 { font-size: 1.0em; }
        .hc-header h4 { font-size: 0.9em; }

        .hc-line {
            width: 100%;
            height: 2px;
            background-color: #F39C12;
            margin: 15px 0 30px 0;
        }

        .hc-content-wrapper {
            position: relative;
            text-align: left;
            padding: 0;
        }

        .hc-watermark {
            position: absolute;
            top: 45%;
            right: 0%;
            transform: translate(20%, -50%) rotate(-15deg);
            width: 60%;
            max-width: 500px;
            opacity: 0.1; 
            z-index: 0;
            pointer-events: none;
        }

        .hc-watermark img {
            width: 100%;
            height: auto;
        }

        .hc-details {
            position: relative;
            z-index: 1; 
            display: grid;
            grid-template-columns: 180px 20px 1fr; 
            gap: 10px;
            font-size: 0.95em;
        }

        .hc-label {
            font-weight: bold;
            color: #3498DB; 
            text-align: left;
        }

        .hc-sep {
            text-align: center;
            font-weight: bold;
        }

        .hc-value {
            color: #333;
            line-height: 1.5;
        }

        .hc-row-spacer {
            grid-column: 1 / -1;
            height: 30px;
        }

        @media (max-width: 1200px) {
            .main-screen-char {
                height: 35vh;
                bottom: -15px;
            }
            .char-left { left: 15px; }
            .char-right { right: 15px; }
        }

        @media (max-width: 992px) {
            #main-screen h1 {
                font-size: 2.8em;
            }
            .main-screen-char {
                height: 30vh; 
                bottom: -10px;
            }
            .button-container {
                grid-template-columns: repeat(2, 1fr); 
                width: 70%;
            }
        }

        @media (max-width: 768px) {
            .main-screen-char {
                display: none; 
            }
            .welcome-images {
                gap: 10px;
            }
            .welcome-char {
                height: 120px;
            }
            #main-screen h1 {
                font-size: 2.5em;
                margin-bottom: 20px;
            }
            .button-container {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
                margin-top: 20px;
                width: 90%;
            }
            #btn-mulai {
                width: 80%;
            }

            .info-content {
                padding: 30px;
                width: 90%;
                border-radius: 15px;
            }
            .info-content h2 {
                font-size: 1.8em;
            }
            .info-content p, .info-content ul, .info-content ol {
                font-size: 1em;
                line-height: 1.5;
            }
            .close-btn {
                font-size: 30px;
            }
            .players-container {
                flex-direction: column;
                align-items: center;
            }
            .player-area {
                max-width: 90%;
            }
            
            .sila-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
            }
            .mc-options {
                grid-template-columns: repeat(3, 1fr); 
            }
            .drop-zones-container {
                grid-template-columns: repeat(3, 1fr); 
            }
            .memory-grid {
                grid-template-columns: repeat(3, 1fr); 
            }
            
            /* Hak Cipta Mobile */
            .hak-cipta-container {
                padding: 15px;
            }
            .hc-details {
                grid-template-columns: 1fr; 
                text-align: center;
            }
            .hc-sep { display: none; }
            .hc-label { 
                margin-bottom: 2px; 
                color: #2980B9; 
                text-align: center;
            }
            .hc-value { margin-bottom: 15px; text-align: center;}
            .hc-header h2 { font-size: 1em; }
            .hc-watermark { opacity: 0.05; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 2em;
            }
            #main-screen h1 {
                font-size: 2em;
            }
            .info-content {
                padding: 20px;
            }
            .info-content h2 {
                font-size: 1.5em;
            }
            .info-content p, .info-content ul, .info-content ol {
                font-size: 0.9em;
            }
            .close-btn {
                font-size: 25px;
                top: 10px;
                right: 10px;
            }
            .sila-grid {
                grid-template-columns: 1fr; 
            }
            .mc-options {
                grid-template-columns: repeat(2, 1fr); 
            }
            .drop-zones-container {
                grid-template-columns: repeat(2, 1fr); 
            }
            .memory-grid {
                grid-template-columns: repeat(2, 1fr); 
            }
            .puzzle-board {
                width: 180px;
                height: 180px;
            }
            .puzzle-piece-draggable {
                width: 58px; 
                height: 58px;
            }
        }
		
        /* --- Style untuk Efek 3D Profile --- */
        .profile-pic-container {
            perspective: 1000px; 
            border-radius: 50%;
            width: 100px; 
            height: 100px; 
            flex-shrink: 0;
            margin-right: 20px;
            overflow: hidden; 
            display: flex; 
            justify-content: center;
            align-items: center;
        }

        .profile-pic-container img {
            transition: transform 0.2s ease-out; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: block;
        }

        /* --- Efek Hover untuk Ikon Media Sosial --- */
        .social-icons .fab { 
            transition: transform 0.3s ease, color 0.3s ease; 
        }

        .social-icons .fab:hover {
            color: #F1C40F; 
            animation: icon-wobble 0.6s ease-in-out; 
        }

        @keyframes icon-wobble {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-15deg) scale(1.1); }
            50% { transform: rotate(10deg) scale(1.1); }
            75% { transform: rotate(-5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }

        /* Style untuk gambar baru di sebelah kanan */
        .modal-bg-image-profile { 
            position: absolute;
            right: 0; 
            top: 0;
            height: 100%;
            opacity: 0.2; 
            pointer-events: none; 
            z-index: 1; 
            object-fit: cover; 
            width: auto; 
        }

        .modal-main-content-profile {
            position: relative;
            z-index: 2; 
            display: flex;
            align-items: center;
            width: 100%;
            padding: 10px; 
        }

        /* Responsive adjustments for profile modal */
        @media (max-width: 768px) {
            .modal-main-content-profile {
                flex-direction: column; 
                text-align: center;
            }
            .profile-pic-container {
                margin-right: 0;
                margin-bottom: 20px; 
                width: 120px; 
                height: 120px;
            }
            .modal-bg-image-profile {
                width: 100%;
                height: auto;
                object-fit: contain; 
                top: 50%;
                right: 0;
                transform: translateY(-50%);
            }
            .info-content .profile-text h2, .info-content .profile-text p {
                text-align: center !important; 
            }
            .social-icons {
                justify-content: center; 
            }
        }

    </style>
</head>
<body>
<audio id="autoSound" src="bangbinasset/bangbinStart.mp3"></audio>

    <!-- Welcome Overlay -->
    <div id="welcome-overlay">
        <div class="welcome-content">
            <div class="welcome-title">Selamat Datang!</div>
            <div class="welcome-images">
                <img src="bangbinasset/COWOO2.png" alt="Karakter 1" class="welcome-char slide-in-left">
                <img src="bangbinasset/CEWEE2.png" alt="Karakter 2" class="welcome-char slide-in-right">
            </div>
            <div class="countdown-circle" id="welcome-count"></div>
        </div>
    </div>

    <!-- Tombol Toggle Fullscreen -->
    <button id="fullscreen-btn" title="Toggle Fullscreen">
        <i class="fas fa-expand"></i>
    </button>

    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <div id="main-screen" class="screen active">
        <h1>Duel Cerdas: Pancasila</h1>
        <h2>Ayo uji pengetahuanmu tentang Sila Pancasila!<h2>
        <div class="button-container">
            <button class="btn-3d" id="btn-tujuan">Tujuan</button>
            <button class="btn-3d" id="btn-petunjuk">Petunjuk</button>
            <button class="btn-3d" id="btn-profil">Profil</button>
            <button class="btn-3d" id="btn-hakcipta">Hak Cipta</button>
        </div>
		<br>
        <img src="bangbinasset/CEWEE.gif" alt="Anak Laki-laki" class="main-screen-char char-left">
        <img src="bangbinasset/COWOO.gif" alt="Anak Perempuan" class="main-screen-char char-right">		
		<button class="btn-3d" id="btn-mulai">Mulai</button>
    </div>

    <div id="introduction-screen" class="screen">
        <h1>Materi: 5 Sila Pancasila</h1>
        <div class="materi-container">
            
            <h2>Klik Ikon Sila untuk Mendengarkan!</h2>
            
            <div class="sila-grid">
                <div class="sila-card" data-sila="1">
                    <img src="bangbinasset/bangbinSila1.PNG" alt="Sila 1" class="sila-img">
                    <span>Sila 1</span>
                </div>
                <div class="sila-card" data-sila="2">
                    <img src="bangbinasset/bangbinSila2.PNG" alt="Sila 2" class="sila-img">
                    <span>Sila 2</span>
                </div>
                <div class="sila-card" data-sila="3">
                    <img src="bangbinasset/bangbinSila3.PNG" alt="Sila 3" class="sila-img">
                    <span>Sila 3</span>
                </div>
                <div class="sila-card" data-sila="4">
                    <img src="bangbinasset/bangbinSila4.PNG" alt="Sila 4" class="sila-img"> 
                    <span>Sila 4</span>
                </div>
                <div class="sila-card" data-sila="5">
                    <img src="bangbinasset/bangbinSila5.PNG" alt="Sila 5" class="sila-img"> 
                    <span>Sila 5</span>
                </div>
            </div>

        </div>
        <div class="button-wrapper">
            <button class="home-button" id="home-from-intro">Home</button>
            <button id="start-game-btn">Paham, Mulai Permainan!</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="game-header">
            <h2 id="level-title">Level 1: Pilihan Ganda</h2>
            <div class="timer-container">
                Waktu: <span id="timer">60</span> detik
            </div>
        </div>

        <div class="players-container">
            <div id="player1-area" class="player-area">
                <h3>Pemain 1</h3>
                <div id="p1-game-content" class="game-content"></div>
                <div class="player-score">Skor: <span id="p1-score">0</span></div>
            </div>
            
            <div id="player2-area" class="player-area">
                <h3>Pemain 2</h3>
                <div id="p2-game-content" class="game-content"></div>
                <div class="player-score">Skor: <span id="p2-score">0</span></div>
            </div>
        </div>
        
        <div id="level-winner-modal" class="modal">
            <div class="modal-content">
                <h2 id="level-winner-text"></h2>
                <p>Bersiap untuk level berikutnya...</p>
                <button id="next-level-btn">Lanjut</button>
            </div>
        </div>
        <button class="home-button" id="home-from-game">Home</button>
    </div>

    <div id="final-screen" class="screen">
        <h1>Permainan Selesai!</h1>
        <h2>Hasil Akhir</h2>
        <div id="final-scores">
            <p>Pemain 1: <span id="final-p1-wins">0</span> Kemenangan</p>
            <p>Pemain 2: <span id="final-p2-wins">0</span> Kemenangan</p>
        </div>
        <h3 id="overall-winner"></h3>
        <button id="play-again-btn">Main Lagi</button>
        <button class="home-button" id="home-from-final"><i class="fa fa-home"></i></button>
    </div>

    <div id="info-modal" class="info-screen">
        <div class="info-content">
            <span class="close-btn">&times;</span>
            <h2 id="info-title"></h2>
            <div id="info-body"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        
        const autoSound = document.getElementById("autoSound");
        autoSound.volume = 1.0;

        const playPromise = autoSound.play();

        if (playPromise !== undefined) {
            playPromise.then(_ => {
                console.log("Autoplay berhasil dimainkan.");
            }).catch(error => {
                console.log("Autoplay dicegah browser. Menunggu interaksi user...");
                const enableAudio = () => {
                    autoSound.play();
                    document.removeEventListener('click', enableAudio);
                    document.removeEventListener('touchstart', enableAudio);
                };
                
                document.addEventListener('click', enableAudio);
                document.addEventListener('touchstart', enableAudio);
            });
        }          

            const welcomeOverlay = document.getElementById('welcome-overlay');
            const welcomeCount = document.getElementById('welcome-count');
            const charLeft = document.querySelector('.welcome-char:nth-child(1)'); // Cewee
            const charRight = document.querySelector('.welcome-char:nth-child(2)'); // Cowoo
            
            let count = 3;
            setTimeout(() => {
                let flash = document.querySelector('.flash-overlay');
                if (!flash) {
                    flash = document.createElement('div');
                    flash.className = 'flash-overlay';
                    welcomeOverlay.appendChild(flash);
                }

                flash.classList.add('show');

                setTimeout(() => {
                    charLeft.src = 'bangbinasset/CEWEE.png';
                    charRight.src = 'bangbinasset/COWOO.png';

                    charLeft.classList.remove('slide-in-left');
                    charRight.classList.remove('slide-in-right');

                    charLeft.classList.add('glow');
                    charRight.classList.add('glow');

                    setTimeout(() => {
                        flash.classList.remove('show');
                        charLeft.classList.remove('glow');
                        charRight.classList.remove('glow');
                    }, 700);

                    charLeft.classList.add('bounce-active');
                    charRight.classList.add('bounce-active');
                }, 120);
            }, 2000);

            const countdownTexts = [
                "Membentuk Karakter Bangsa...",
                "Menguatkan Persatuan...",
                "Siap Belajar Pancasila!"
            ];

            let stage = 0;
            const welcomeInterval = setInterval(() => {
                if (stage < countdownTexts.length) {
                    welcomeCount.textContent = countdownTexts[stage];
                    stage++;
                } else {
                    clearInterval(welcomeInterval);
                    welcomeCount.textContent = "GO!";
                    setTimeout(() => {
                        welcomeOverlay.classList.add('hidden');
                    }, 500);
                }
            }, 1000);

            // --- LOGIKA FULLSCREEN ---
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const fullscreenIcon = fullscreenBtn.querySelector('i');

            fullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            });

            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) {
                    fullscreenIcon.classList.remove('fa-compress');
                    fullscreenIcon.classList.add('fa-expand');
                } else {
                    fullscreenIcon.classList.remove('fa-expand');
                    fullscreenIcon.classList.add('fa-compress');
                }
            });

            // --- DATA PERMAINAN PANCASILA ---
            const silaData = {
                '1': {
                    title: 'Sila 1: Ketuhanan Yang Maha Esa',
                    icon: '<img src="bangbinasset/bangbinSila1.PNG" alt="Sila 1" class="sila-img" style="width: 25px; height: 25px; vertical-align: middle;">',
                    audio: 'bangbinasset/sila1.opus',
                    ketAudio: 'bangbinasset/ketSila1.mp3',
                    content: `
                        <p>Mengakui adanya Tuhan dan menjalankan ibadah sesuai agama masing-masing.</p>
                        <strong>Contoh di Rumah:</strong>
                        <ul>
                            <li>Berdoa bersama keluarga sebelum makan.</li>
                            <li>Rajin beribadah bersama orang tua.</li>
                            <li>Menghormati anggota keluarga yang berbeda keyakinan (jika ada).</li>
                        </ul>
                    `
                },
                '2': {
                    title: 'Sila 2: Kemanusiaan yang Adil dan Beradab',
                    icon: '<img src="bangbinasset/bangbinSila2.PNG" alt="Sila 2" class="sila-img" style="width: 25px; height: 25px; vertical-align: middle;">',
                    audio: 'bangbinasset/sila2.opus',
                    ketAudio: 'bangbinasset/ketSila2.mp3',
                    content: `
                        <p>Saling menghargai dan menolong sesama manusia tanpa membedakan.</p>
                        <strong>Contoh di Rumah:</strong>
                        <ul>
                            <li>Membantu pekerjaan orang tua (misal: membersihkan kamar).</li>
                            <li>Berbicara dengan sopan kepada Ayah, Ibu, Kakak, dan Adik.</li>
                            <li>Menjenguk anggota keluarga yang sedang sakit.</li>
                        </ul>
                    `
                },
                '3': {
                    title: 'Sila 3: Persatuan Indonesia',
                    icon: '<img src="bangbinasset/bangbinSila3.PNG" alt="Sila 3" class="sila-img" style="width: 25px; height: 25px; vertical-align: middle;">',
                    audio: 'bangbinasset/sila3.opus',
                    ketAudio: 'bangbinasset/ketSila3.mp3',
                    content: `
                        <p>Menjaga persatuan dan kesatuan, cinta tanah air.</p>
                        <strong>Contoh di Rumah:</strong>
                        <ul>
                            <li>Rukun dengan kakak atau adik, tidak bertengkar.</li>
                            <li>Bekerja sama membersihkan rumah.</li>
                            <li>Menggunakan produk buatan Indonesia di rumah.</li>
                        </ul>
                    `
                },
                '4': {
                    title: 'Sila 4: Kerakyatan yang Dipimpin oleh Hikmat Kebijaksanaan dalam Permusyawaratan Perwakilan',
                    icon: '<img src="bangbinasset/bangbinSila4.PNG" alt="Sila 4" class="sila-img" style="width: 25px; height: 25px; vertical-align: middle;">',
                    audio: 'bangbinasset/sila4.opus',
                    ketAudio: 'bangbinasset/ketSila4.mp3',
                    content: `
                        <p>Menyelesaikan masalah dengan musyawarah untuk mencapai mufakat (keputusan bersama).</p>
                        <strong>Contoh di Rumah:</strong>
                        <ul>
                            <li>Berdiskusi untuk menentukan tempat liburan keluarga.</li>
                            <li>Menerima keputusan bersama dengan lapang dada.</li>
                            <li>Tidak memaksakan keinginan pribadi (misal: ingin nonton TV saat yang lain ingin belajar).</li>
                        </ul>
                    `
                },
                '5': {
                    title: 'Sila 5: Keadilan Sosial bagi Seluruh Rakyat Indonesia',
                    icon: '<img src="bangbinasset/bangbinSila5.PNG" alt="Sila 5" class="sila-img" style="width: 25px; height: 25px; vertical-align: middle;">',
                    audio: 'bangbinasset/sila5.opus',
                    ketAudio: 'bangbinasset/ketSila5.mp3',
                    content: `
                        <p>Bersikap adil terhadap sesama dan menghargai hak orang lain.</p>
                        <strong>Contoh di Rumah:</strong>
                        <ul>
                            <li>Membagi makanan atau mainan secara adil dengan saudara.</li>
                            <li>Orang tua memberikan uang saku yang adil sesuai kebutuhan.</li>
                            <li>Rajin menabung dan tidak boros.</li>
                        </ul>
                    `
                }
            };
            
            const pancasilaItems = [
                { name: 'Bintang', category: 'Sila 1', symbol: '<img src="bangbinasset/bangbinSila1.PNG" alt="Sila 1" class="sila-img">', audio: 'bangbinasset/Sila1.opus', imgSrc: 'bangbinasset/bangbinSila1.PNG' },
                { name: 'Rantai', category: 'Sila 2', symbol: '<img src="bangbinasset/bangbinSila2.PNG" alt="Sila 2" class="sila-img">', audio: 'bangbinasset/Sila2.opus', imgSrc: 'bangbinasset/bangbinSila2.PNG' },
                { name: 'Pohon Beringin', category: 'Sila 3', symbol: '<img src="bangbinasset/bangbinSila3.PNG" alt="Sila 3" class="sila-img">', audio: 'bangbinasset/Sila3.opus', imgSrc: 'bangbinasset/bangbinSila3.PNG' },
                { name: 'Kepala Banteng', category: 'Sila 4', symbol: '<img src="bangbinasset/bangbinSila4.PNG" alt="Sila 4" class="sila-img">', audio: 'bangbinasset/Sila4.opus', imgSrc: 'bangbinasset/bangbinSila4.PNG' },
                { name: 'Padi dan Kapas', category: 'Sila 5', symbol: '<img src="bangbinasset/bangbinSila5.PNG" alt="Sila 5" class="sila-img">', audio: 'bangbinasset/Sila5.opus', imgSrc: 'bangbinasset/bangbinSila5.PNG' }
            ];

            const level3PancasilaPairs = [
                { pairId: 'sila-1', type: 'symbol', content: '<img src="bangbinasset/bangbinSila1.PNG" alt="Sila 1" class="sila-img">', audio: null },
                { pairId: 'sila-1', type: 'text', content: 'Sila 1', audio: 'bangbinasset/bangbinSila1.opus' },
                { pairId: 'sila-2', type: 'symbol', content: '<img src="bangbinasset/bangbinSila2.PNG" alt="Sila 2" class="sila-img">', audio: null },
                { pairId: 'sila-2', type: 'text', content: 'Sila 2', audio: 'bangbinasset/bangbinSila2.opus' },
                { pairId: 'sila-3', type: 'symbol', content: '<img src="bangbinasset/bangbinSila3.PNG" alt="Sila 3" class="sila-img">', audio: null },
                { pairId: 'sila-3', type: 'text', content: 'Sila 3', audio: 'bangbinasset/bangbinSila3.opus' },
                { pairId: 'sila-4', type: 'symbol', content: '<img src="bangbinasset/bangbinSila4.PNG" alt="Sila 4" class="sila-img">', audio: null },
                { pairId: 'sila-4', type: 'text', content: 'Sila 4', audio: 'bangbinasset/bangbinSila4.opus' },
                { pairId: 'sila-5', type: 'symbol', content: '<img src="bangbinasset/bangbinSila5.PNG" alt="Sila 5" class="sila-img">', audio: null },
                { pairId: 'sila-5', type: 'text', content: 'Sila 5', audio: 'bangbinasset/bangbinSila5.opus' }
            ];

            const screens = {
                main: document.getElementById('main-screen'),
                introduction: document.getElementById('introduction-screen'),
                game: document.getElementById('game-screen'),
                final: document.getElementById('final-screen')
            };
            
            const startGameBtn = document.getElementById('start-game-btn');
            const nextLevelBtn = document.getElementById('next-level-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const levelTitle = document.getElementById('level-title');
            const timerDisplay = document.getElementById('timer');
            const p1Content = document.getElementById('p1-game-content');
            const p2Content = document.getElementById('p2-game-content');
            const p1ScoreDisplay = document.getElementById('p1-score');
            const p2ScoreDisplay = document.getElementById('p2-score');
            const levelWinnerModal = document.getElementById('level-winner-modal');
            const levelWinnerText = document.getElementById('level-winner-text');

            const btnTujuan = document.getElementById('btn-tujuan');
            const btnPetunjuk = document.getElementById('btn-petunjuk');
            const btnProfil = document.getElementById('btn-profil');
            const btnHakCipta = document.getElementById('btn-hakcipta');
            const btnMulai = document.getElementById('btn-mulai');

            const infoModal = document.getElementById('info-modal');
            const infoTitle = document.getElementById('info-title');
            const infoBody = document.getElementById('info-body');
            const closeInfoBtn = document.querySelector('.close-btn');

            const homeFromIntroBtn = document.getElementById('home-from-intro');
            const homeFromGameBtn = document.getElementById('home-from-game');
            const homeFromFinalBtn = document.getElementById('home-from-final');

            // --- AUDIO ELEMENTS ---
            const sounds = {
                levelChange: new Audio('bangbinasset/bangbincomplete.wav'),
                correct: new Audio('bangbinasset/bangbincorrect.mp3'),
                wrong: new Audio('bangbinasset/bangbinwrong.mp3'),
                buttonClick: new Audio('bangbinasset/bangbinclick.mp3'),
				victory: new Audio('bangbinasset/bangbinWinner.mp3'), 
                buttonHover: new Audio('bangbinasset/tombolBangbin.wav'),
                levelComplete: new Audio('bangbinasset/bangbincompletelevel.mp3')
            };
            
            const audioPlayer = new Audio();
            audioPlayer.onerror = () => {
                console.error(`Error: Gagal memuat file audio ${audioPlayer.src}`);
            };


            // --- STATE PERMAINAN ---
            let currentLevel = 0;
            let p1Score = 0;
            let p2Score = 0;
            let p1Wins = 0;
            let p2Wins = 0;
            let timer;
            let timeLeft;
            let levelInProgress = false;

            // --- FUNGSI AUDIO & ANIMASI ---
            function playSound(sound) {
                sound.currentTime = 0;
                sound.play().catch(error => console.log(`Error playing sound: ${error}`));
            }
            
            function playSilaSound(src) {
                audioPlayer.pause();
                audioPlayer.src = src;
                audioPlayer.currentTime = 0;
                audioPlayer.play().catch(error => console.error(`Gagal memutar ${src}: ${error}`));
            }

            function addHoverSound(element) {
                if (element) { 
                    element.addEventListener('mouseenter', () => {
                        playSound(sounds.buttonHover);
                    });
                }
            }

            function createFallingElement(type) {
                const element = document.createElement('div');
                element.classList.add('falling-element');
                if (type === 'p1-win') {
                    const icons = ['<img src="bangbinasset/bangbinSila1.PNG" alt="Sila 1" class="sila-img">', '<img src="bangbinasset/bangbinSila3.PNG" alt="Sila 3" class="sila-img">', '<img src="bangbinasset/bangbinSila5.PNG" alt="Sila 5" class="sila-img">'];
                    element.innerHTML = icons[Math.floor(Math.random() * icons.length)];
                } else if (type === 'p2-win') {
                    const icons = ['<img src="bangbinasset/bangbinSila2.PNG" alt="Sila 2" class="sila-img">', '<img src="bangbinasset/bangbinSila4.PNG" alt="Sila 4" class="sila-img">'];
                    element.innerHTML = icons[Math.floor(Math.random() * icons.length)];
                }
                
                const size = Math.random() * 2 + 1.5; 
                element.style.width = `${size}rem`;
                element.style.height = `${size}rem`;
                
                element.style.color = 'white';
                element.style.left = `${Math.random() * 90 + 5}vw`;
                element.style.animationDuration = `${Math.random() * 3 + 4}s`; 
                document.body.appendChild(element);

                setTimeout(() => {
                    element.remove();
                }, 7000); 
            }

            function startVictoryAnimation(winnerType) {
                const animationInterval = setInterval(() => {
                    for (let i = 0; i < 3; i++) {
                        createFallingElement(winnerType);
                    }
                }, 200);

                setTimeout(() => clearInterval(animationInterval), 5000);
            }

            // --- FUNGSI UTAMA ---
            function init() {
                btnTujuan.addEventListener('click', () => showInfo('tujuan'));
                btnPetunjuk.addEventListener('click', () => showInfo('petunjuk'));
                btnProfil.addEventListener('click', () => showInfo('profil'));
                btnHakCipta.addEventListener('click', () => showInfo('hakcipta'));

                btnMulai.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    switchScreen('introduction');
                });

                startGameBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    startGame();
                });
                nextLevelBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    startNextLevel();
                });
                playAgainBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    location.reload(); 
                });
                closeInfoBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    audioPlayer.pause(); 
                    infoModal.classList.remove('show');
                    infoModal.addEventListener('transitionend', function handler() {
                        infoModal.style.display = 'none';
                        infoModal.removeEventListener('transitionend', handler);
                    });
                });

                homeFromIntroBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    switchScreen('main');
                });
                homeFromGameBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    clearInterval(timer);
                    resetGame();
                    switchScreen('main');
                });
                homeFromFinalBtn.addEventListener('click', () => {
                    playSound(sounds.buttonClick);
                    resetGame();
                    switchScreen('main');
                });
                
                document.querySelectorAll('.sila-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const silaNum = card.dataset.sila;
                        showSilaModal(silaNum);
                    });
                });

                addHoverSound(btnTujuan);
                addHoverSound(btnPetunjuk);
                addHoverSound(btnProfil);
                addHoverSound(btnHakCipta);
                addHoverSound(btnMulai);
                addHoverSound(startGameBtn);
                addHoverSound(homeFromIntroBtn);
                addHoverSound(homeFromGameBtn);
                addHoverSound(nextLevelBtn);
                addHoverSound(playAgainBtn);
                addHoverSound(homeFromFinalBtn);
                addHoverSound(closeInfoBtn);
                addHoverSound(fullscreenBtn);
                
                document.querySelectorAll('.sila-card').forEach(addHoverSound);
            }

            function switchScreen(screenName) {
                for (const key in screens) {
                    screens[key].classList.remove('active');
                }
                screens[screenName].classList.add('active');
            }
            
            function showSilaModal(silaNumber) {
                const data = silaData[silaNumber];
                if (!data) return;
                
                playSilaSound(data.audio);
                infoTitle.innerHTML = data.title;
                infoBody.innerHTML = data.content + `<button id="play-ket-btn">Dengarkan Penjelasan ${data.icon}</button>`;
                
                infoModal.style.display = 'flex';
                infoModal.offsetHeight; 
                infoModal.classList.add('show');
                
                const playKetBtn = document.getElementById('play-ket-btn');
                if (playKetBtn) {
                    playKetBtn.onclick = () => {
                        playSilaSound(data.ketAudio);
                    };
                    addHoverSound(playKetBtn);
                }
            }


            function showInfo(type) {
                playSound(sounds.buttonClick);
                let title = '';
                let content = '';
                
                const infoContent = infoModal.querySelector('.info-content');
                infoContent.style.background = '';
                infoContent.style.maxWidth = '';
                infoContent.style.padding = '';
                infoContent.style.width = '';
                infoContent.style.border = '';
                infoModal.querySelector('.close-btn').style.color = '';
                infoModal.querySelector('.close-btn').style.textShadow = '';
                infoTitle.style.display = 'block'; // Reset display title

                if (type === 'tujuan') {
                    title = 'Tujuan Pembelajaran';
                    content = `
                        <p>Game ini dirancang untuk membantu pemain:</p>
                        <ul>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinTujuan1.mp3">Mengenal 5 Lambang Sila Pancasila.</li>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinTujuan2.mp3">Menemutunjukkan lambang sila dengan nama silanya.</li>
                        </ul>
                    `;
                } else if (type === 'petunjuk') {
                    title = 'Petunjuk Permainan';
                    content = `
                        <p>Game ini terdiri dari 4 level:</p>
                        <ol>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinPetunjuk1.mp3"><strong>Level 1: Lambang Sila</strong> - Pilih nomor sila yang benar (Sila 1-5) untuk lambang yang muncul.</li>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinPetunjuk2.mp3"><strong>Level 2: Cocokkan Lambang Sila</strong> - Seret (drag) setiap lambang sila ke kotak urutan yang benar (Sila 1-5).</li>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinPetunjuk3.mp3"><strong>Level 3: Ingat Lambang Sila</strong> - Temukan pasangan Lambang Sila dan Nama Silanya.</li>
                            <li class="clickable-list-item" data-audio="bangbinasset/bangbinPetunjuk4.mp3"><strong>Level 4: Puzzle Sila</strong> - Seret potongan gambar dari wadah bawah ke kotak kosong di atas untuk menyusun gambar Sila yang utuh.</li>
                        </ol>
                        <p>Setiap level punya batas waktu. Kumpulkan poin sebanyak mungkin untuk jadi pemenang!</p>
                    `;
                    } else if (type === 'profil') {
                    content = `
                        <div class="modal-main-content-profile">
                            <div class="profile-pic-container">
                                <img src="bangbinasset/Bangbin.jpg" alt="Foto Profil">
                            </div>
                            <div class="profile-text" style="color: white; text-align: left; flex-grow: 1;">
                                <h2 style="margin: 0; font-size: 1.5em; color: black; text-shadow: none; text-align: left;">PENGEMBANG</h2>
                                <h2 style="margin: 0; font-size: 1.5em; color: white; text-shadow: none; text-align: left;">BINTANG ADHI PERMANA</h2>
                                <p style="margin: 5px 0; font-size: 0.9em; text-align: left;">SDN Lubang Buaya 01, Jakarta Timur</p>
                                <p style="margin: 10px 0 5px 0; font-weight: bold; font-size: 0.9em; text-align: left;">Kontak:</p>
                                <div class="social-icons" style="font-size: 1.8em; display: flex; gap: 15px; justify-content: flex-start;">
                                    <a href="https://www.facebook.com/bintang.a.permana.1/" target="_blank" style="color: white; text-decoration: none;"><i class="fab fa-facebook"></i></a>
                                    <a href="https://www.youtube.com/@Bangbin_1" target="_blank" style="color: white; text-decoration: none;"><i class="fab fa-youtube"></i></a>
                                    <a href="https://wa.me/6281310051985" target="_blank" style="color: white; text-decoration: none;"><i class="fab fa-whatsapp"></i></a>
                                </div>
                            </div>
                        </div>
                        <img src="bangbinasset/bangbin.png" alt="Background" class="modal-bg-image-profile">
                    `;
                    infoContent.style.background = 'linear-gradient(135deg, #4e54c8, #8f94fb)';
                    infoContent.style.maxWidth = '700px';
                    infoContent.style.padding = '25px';
                    infoModal.querySelector('.close-btn').style.color = 'white';
                } else if (type === 'hakcipta') {
                    // HAK CIPTA BARU
                    title = ''; 
                    content = `
                        <div class="hak-cipta-container">
                            <img src="bangbinasset/favicon.ico" alt="Logo Tut Wuri" class="hc-logo-top">
                            
                            <div class="hc-header">
                                <h2>DIREKTORAT SEKOLAH DASAR</h2>
                                <h3>KEMENTERIAN PENDIDIKAN DASAR DAN MENENGAH</h3>
                                <h4>DIREKTORAT JENDERAL PENDIDIKAN ANAK USIA DINI, PENDIDIKAN DASAR DAN PENDIDIKAN MENENGAH</h4>
                            </div>
                            
                            <div class="hc-line"></div>

                            <div class="hc-content-wrapper">
                                <div class="hc-watermark">
                                    <img src="bangbinasset/favicon.ico" alt="Watermark Logo">
                                </div>
                                
                                <div class="hc-details">
                                    <div class="hc-label">Pengarah</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">Moch. Salim Somad, S.Kom., M.Pd., Direktorat Sekolah Dasar</div>

                                    <div class="hc-label">Penanggung Jawab</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">Lanny Anggraini, S.Pd., M.A., Direktorat Sekolah Dasar</div>

                                    <div class="hc-label">Pengembang</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">Bintang Adhi Permana, M.Pd</div>

                                    <div class="hc-label">Pengkaji Materi</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">Kurator, MBG</div>

                                    <div class="hc-label">Pengkaji Media</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">
                                        1. Muh. Noor Ginanjar Jaelani, S.Pd., Direktorat Sekolah Dasar<br>
                                        2. Ine Rahmawati, S.Pd., M.Si., Direktorat Sekolah Dasar
                                    </div>

                                    <div class="hc-row-spacer"></div>

                                    <div class="hc-label">Diterbitkan oleh</div>
                                    <div class="hc-sep">:</div>
                                    <div class="hc-value">
                                        Direktorat Sekolah Dasar<br>
                                        Direktorat Jenderal Pendidikan Anak Usia Dini, Pendidikan Dasar, dan Pendidikan Menengah<br>
                                        Kementerian Pendidikan Dasar dan Menengah<br>
                                        Tahun 2025
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    infoContent.style.background = '#ffffff';
                    infoContent.style.maxWidth = '1000px'; // Lebih lebar
                    infoContent.style.width = '95%';
                    infoContent.style.padding = '10px';
                    infoContent.style.border = 'none'; 
                    infoModal.querySelector('.close-btn').style.color = '#E74C3C';
                    infoTitle.style.display = 'none'; // Sembunyikan judul default
                }

                infoTitle.innerHTML = title;
                infoBody.innerHTML = content;
                infoModal.style.display = 'flex';
                infoModal.offsetHeight; 
                infoModal.classList.add('show');

                if (type === 'tujuan' || type === 'petunjuk') {
                    const listItems = infoBody.querySelectorAll('.clickable-list-item');
                    listItems.forEach(item => {
                        item.addEventListener('click', () => {
                            const audioSrc = item.dataset.audio;
                            if (audioSrc) {
                                playSilaSound(audioSrc); 
                            }
                        });
                        addHoverSound(item); 
                    });
                }

                if (type === 'profil') {
                    const profilePicContainer = infoModal.querySelector('.profile-pic-container');
                    if (profilePicContainer) {
                        const profilePic = profilePicContainer.querySelector('img');
                        const maxRotate = 15;
                        profilePicContainer.addEventListener('mousemove', (e) => {
                            const rect = profilePicContainer.getBoundingClientRect();
                            const mouseX = e.clientX - rect.left;
                            const mouseY = e.clientY - rect.top;
                            const rotateY = ((mouseX / rect.width) - 0.5) * 2 * maxRotate;
                            const rotateX = (((mouseY / rect.height) - 0.5) * 2 * maxRotate) * -1;
                            profilePic.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.1)`;
                        });
                        profilePicContainer.addEventListener('mouseleave', () => {
                            profilePic.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
                        });
                    }
                }
            }
            
            function startGame() {
                currentLevel = 1;
                p1Wins = 0;
                p2Wins = 0;
                switchScreen('game');
                loadLevel();
            }
            
            function startNextLevel() {
                playSound(sounds.levelChange);
                levelWinnerModal.style.display = 'none';
                currentLevel++;
                if (currentLevel > 4) { 
                    showFinalScreen();
                } else {
                    loadLevel();
                }
            }

            function loadLevel() {
                levelInProgress = true;
                p1Score = 0;
                p2Score = 0;
                updateScores();
                p1Content.innerHTML = '';
                p2Content.innerHTML = '';

                let levelTime;

                if (currentLevel === 1) {
                    levelTitle.textContent = 'Level 1: Lambang Sila';
                    levelTime = 20;
                    setupLevel1();
                } else if (currentLevel === 2) {
                    levelTitle.textContent = 'Level 2: Cocokkan Lambang Sila';
                    levelTime = 45;
                    setupLevel2();
                } else if (currentLevel === 3) {
                    levelTitle.textContent = 'Level 3: Memory Game Sila';
                    levelTime = 40;
                    setupLevel3();
                } else if (currentLevel === 4) {
                    levelTitle.textContent = 'Level 4: Puzzle Sila (Drag & Drop)';
                    levelTime = 60; 
                    setupLevel4();
                }
                
                startTimer(levelTime);
            }
            
            function startTimer(duration) {
                timeLeft = duration;
                timerDisplay.textContent = timeLeft;
                clearInterval(timer);
                timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        endLevel();
                    }
                }, 1000);
            }

            function endLevel() {
                if (!levelInProgress) return;
                levelInProgress = false;
                clearInterval(timer);
                
                let currentLevelWinner = '';
                if (p1Score > p2Score) {
                    p1Wins++;
                    currentLevelWinner = 'Pemain 1 Menang Level Ini!';
                } else if (p2Score > p1Score) {
                    p2Wins++;
                    currentLevelWinner = 'Pemain 2 Menang Level Ini!';
                } else {
                    currentLevelWinner = 'Level Ini Berakhir Seri!';
                }
                
                playSound(sounds.levelComplete); 
                levelWinnerText.textContent = currentLevelWinner;
                levelWinnerModal.style.display = 'flex';
            }
            
            function updateScores() {
                p1ScoreDisplay.textContent = p1Score;
                p2ScoreDisplay.textContent = p2Score;
            }

            function resetGame() {
                clearInterval(timer);
                currentLevel = 0;
                p1Score = 0;
                p2Score = 0;
                p1Wins = 0;
                p2Wins = 0;
                levelInProgress = false;
                p1Content.innerHTML = '';
                p2Content.innerHTML = '';
                updateScores();
            }

            // --- LOGIKA LEVEL 1: PANCASILA ---
            function setupLevel1() {
                let availableItemsP1 = [...pancasilaItems]; 
                let availableItemsP2 = [...pancasilaItems];

                function getRandomUniqueItem(playerItems) {
                    if (playerItems.length === 0) {
                        playerItems.push(...pancasilaItems);
                        playerItems.sort(() => Math.random() - 0.5); 
                    }
                    const randomIndex = Math.floor(Math.random() * playerItems.length);
                    const item = playerItems[randomIndex];
                    playerItems.splice(randomIndex, 1);
                    return item;
                }

                function generateQuestion(player) {
                    const correctItem = (player === 1) ? getRandomUniqueItem(availableItemsP1) : getRandomUniqueItem(availableItemsP2);
                    const options = ['Sila 1', 'Sila 2', 'Sila 3', 'Sila 4', 'Sila 5'].sort(() => Math.random() - 0.5);

                    const content = `
                        <div class="mc-question">
                            ${correctItem.symbol}
                            <p>Termasuk Sila ke berapakah lambang ini?</p>
                        </div>
                        <div class="mc-options">
                            ${options.map(opt => `<button data-correct="${opt === correctItem.category}">${opt}</button>`).join('')}
                        </div>`;
                    return { content };
                }

                function displayQuestion(playerArea, player) {
                    if (!levelInProgress) return;

                    const { content } = generateQuestion(player);
                    playerArea.innerHTML = content;
                    playerArea.querySelectorAll('.mc-options button').forEach(button => {
                        button.addEventListener('click', () => {
                            playSound(sounds.buttonClick);
                            if (!levelInProgress) return;

                            if (button.dataset.correct === 'true') {
                                playSound(sounds.correct);
                                if (player === 1) p1Score++; else p2Score++;
                                updateScores();
                                if(levelInProgress) displayQuestion(playerArea, player); 
                            } else {
                                playSound(sounds.wrong);
                                button.style.backgroundColor = '#E74C3C';
                                button.style.boxShadow = '0 4px #c0392b';
                                setTimeout(() => {
                                    if(levelInProgress) displayQuestion(playerArea, player); 
                                }, 500);
                            }
                        });
                        addHoverSound(button); 
                    });
                }
                
                displayQuestion(p1Content, 1);
                displayQuestion(p2Content, 2);
            }
            
            // --- LOGIKA LEVEL 2: DRAG AND DROP (VERSI PANCASILA) ---
            function setupLevel2() {
                function setupPlayerDragDrop(playerContent, playerNum) {
                    const shuffledItems = [...pancasilaItems].sort(() => Math.random() - 0.5);
                    let droppedCount = 0;
                    const totalItems = pancasilaItems.length; 

                    const dropZoneHTML = ['Sila 1', 'Sila 2', 'Sila 3', 'Sila 4', 'Sila 5']
                        .map(sila => `<div class="drop-zone" data-category="${sila}"><h3>${sila}</h3></div>`)
                        .join('');

                    playerContent.innerHTML = `
                        <div class="level2-container">
                            <p style="font-weight: bold;">Seret lambang ke kotak sila yang benar!</p>
                            <div id="p${playerNum}-items-container" class="items-container">
                            </div>
                            <div class="drop-zones-container">
                                ${dropZoneHTML}
                            </div>
                        </div>`;

                    const itemsContainer = document.getElementById(`p${playerNum}-items-container`);
                    const dropZones = playerContent.querySelectorAll('.drop-zone');

                    shuffledItems.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.id = `p${playerNum}-item-${index}`;
                        div.classList.add('draggable-item');
                        div.draggable = true;
                        div.dataset.category = item.category;
                        div.dataset.audio = item.audio; 
                        div.innerHTML = `${item.symbol}`;
                        itemsContainer.appendChild(div);
                    });
                    
                    const draggables = playerContent.querySelectorAll('.draggable-item');
                    let draggedItem = null;

                    draggables.forEach(item => {
                        item.addEventListener('dragstart', (e) => {
                            draggedItem = item;
                            playSilaSound(item.dataset.audio); 
                            setTimeout(() => item.classList.add('dragging'), 0);
                            e.dataTransfer.setData('text/plain', item.id);
                        });

                        item.addEventListener('dragend', () => {
                            draggedItem.classList.remove('dragging');
                            draggedItem = null;
                        });

                        item.addEventListener('touchstart', (e) => {
                            draggedItem = item;
                            playSilaSound(draggedItem.dataset.audio); 
                            draggedItem.classList.add('dragging');
                        }, { passive: true });
                    });

                    dropZones.forEach(zone => {
                        zone.addEventListener('dragover', e => {
                            e.preventDefault();
                            zone.classList.add('drag-over');
                        });

                        zone.addEventListener('dragleave', () => {
                            zone.classList.remove('drag-over');
                        });

                        zone.addEventListener('drop', e => {
                            e.preventDefault();
                            zone.classList.remove('drag-over');
                            const id = e.dataTransfer.getData('text/plain');
                            const droppedElement = document.getElementById(id);
                            handleDrop(droppedElement, zone);
                        });
                    });

                    playerContent.addEventListener('touchmove', e => {
                        if (!draggedItem) return;
                        e.preventDefault(); 
                        
                        const touch = e.targetTouches[0];
                        const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementUnderTouch ? elementUnderTouch.closest('.drop-zone') : null;
                        
                        dropZones.forEach(dz => dz.classList.remove('drag-over'));
                        if (dropZone) {
                            dropZone.classList.add('drag-over');
                        }
                    }, { passive: false });

                    playerContent.addEventListener('touchend', e => {
                        if (!draggedItem) return;

                        const touch = e.changedTouches[0];
                        const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementUnderTouch ? elementUnderTouch.closest('.drop-zone') : null;

                        if (dropZone) {
                            handleDrop(draggedItem, dropZone);
                        }
                        
                        draggedItem.classList.remove('dragging');
                        dropZones.forEach(dz => dz.classList.remove('drag-over'));
                        draggedItem = null;
                    });
                    
                    function handleDrop(item, zone) {
                        if (!levelInProgress || !item) return;

                        if (item.dataset.category === zone.dataset.category) {
                            playSound(sounds.correct);
                            if (playerNum === 1) p1Score++; else p2Score++;
                            updateScores();

                            const icon = document.createElement('div');
                            icon.innerHTML = item.querySelector('img').outerHTML; 
                            icon.classList.add('dropped-icon');
                            zone.appendChild(icon); 
                            item.remove(); 
                            
                            droppedCount++;
                            if (droppedCount === totalItems) { 
                                setTimeout(endLevel, 100);
                            }
                        } else {
                            playSound(sounds.wrong);
                            item.classList.add('shake');
                            setTimeout(() => item.classList.remove('shake'), 300);
                        }
                    }
                }
                
                setupPlayerDragDrop(p1Content, 1);
                setupPlayerDragDrop(p2Content, 2);
            }
            
            // --- LOGIKA LEVEL 3: MEMORY GAME (VERSI PANCASILA) ---
            function setupLevel3() {
                function createGrid(container, playerNum) {
                    const shuffledCards = [...level3PancasilaPairs].sort(() => Math.random() - 0.5);
                    container.innerHTML = `<div class="memory-grid" id="p${playerNum}-grid"></div>`;
                    const grid = document.getElementById(`p${playerNum}-grid`);
                    
                    shuffledCards.forEach(data => {
                        const card = document.createElement('div');
                        card.classList.add('memory-card');
                        card.dataset.pairId = data.pairId;
                        card.dataset.audio = data.audio || 'null';
                        
                        card.innerHTML = `
                            <div class="back-face">?</div>
                            <div class="front-face">${data.content}</div>`;
                        grid.appendChild(card);
                        addHoverSound(card); 
                    });
                }
                
                function setupPlayerMemory(playerContent, playerNum) {
                    createGrid(playerContent, playerNum);
                    let flippedCards = [];
                    let matchedPairs = 0;
                    let canFlip = true;
                    const totalPairs = level3PancasilaPairs.length / 2;

                    playerContent.querySelectorAll('.memory-card').forEach(card => {
                        card.addEventListener('click', () => {
                            playSound(sounds.buttonClick);
                            if (!canFlip || card.classList.contains('flip') || !levelInProgress) return;
                            
                            card.classList.add('flip');
                            
                            if (card.dataset.audio !== 'null') {
                                playSilaSound(card.dataset.audio);
                            }
                            
                            flippedCards.push(card);

                            if (flippedCards.length === 2) {
                                canFlip = false;
                                const [card1, card2] = flippedCards;
                                if(card1.dataset.pairId === card2.dataset.pairId) {
                                    playSound(sounds.correct);
                                    if(playerNum === 1) p1Score++; else p2Score++;
                                    updateScores();
                                    matchedPairs++;
                                    if (matchedPairs === totalPairs) {
                                        audioPlayer.pause(); 
                                        endLevel();
                                    }
                                    canFlip = true;
                                } else {
                                    playSound(sounds.wrong);
                                    setTimeout(() => {
                                        card1.classList.remove('flip');
                                        card2.classList.remove('flip');
                                        canFlip = true;
                                    }, 1000);
                                }
                                flippedCards = [];
                            }
                        });
                    });
                }

                // --- LOGIKA LEVEL 4: PUZZLE DRAG & DROP ---
                function setupLevel4() {
                    function setupPlayerPuzzle(playerContent, playerNum) {
                        const randomSila = pancasilaItems[Math.floor(Math.random() * pancasilaItems.length)];
                        const imgSrc = randomSila.imgSrc;
                        const gridSize = 3;

                        playerContent.innerHTML = `
                            <div class="puzzle-wrapper">
                                <p class="puzzle-reference">Susun menjadi gambar ini: <img src="${imgSrc}" alt="Target"></p>
                                <div class="puzzle-board" id="p${playerNum}-puzzle-board"></div>
                                <div class="puzzle-pool" id="p${playerNum}-puzzle-pool"></div>
                            </div>
                        `;
                        
                        const puzzleBoard = document.getElementById(`p${playerNum}-puzzle-board`);
                        const puzzlePool = document.getElementById(`p${playerNum}-puzzle-pool`);
                        
                        for (let i = 0; i < gridSize * gridSize; i++) {
                            const slot = document.createElement('div');
                            slot.classList.add('puzzle-slot');
                            slot.dataset.index = i;
                            puzzleBoard.appendChild(slot);
                        }

                        let pieces = [];
                        for (let row = 0; row < gridSize; row++) {
                            for (let col = 0; col < gridSize; col++) {
                                const index = row * gridSize + col;
                                pieces.push({
                                    correctIndex: index,
                                    bgPosX: col * 100 / (gridSize - 1),
                                    bgPosY: row * 100 / (gridSize - 1)
                                });
                            }
                        }

                        let shuffledPieces = [...pieces].sort(() => Math.random() - 0.5);
                        
                        shuffledPieces.forEach((pieceData, i) => {
                            const piece = document.createElement('div');
                            piece.classList.add('puzzle-piece-draggable');
                            piece.style.backgroundImage = `url('${imgSrc}')`;
                            piece.style.backgroundPosition = `${pieceData.bgPosX}% ${pieceData.bgPosY}%`;
                            piece.dataset.correctIndex = pieceData.correctIndex;
                            piece.draggable = true;
                            piece.id = `p${playerNum}-piece-${i}`; // Unique ID for drag event
                            puzzlePool.appendChild(piece);
                            addHoverSound(piece);
                        });

                        let draggedPiece = null;
                        const allPieces = playerContent.querySelectorAll('.puzzle-piece-draggable');
                        const allSlots = playerContent.querySelectorAll('.puzzle-slot');

                        allPieces.forEach(piece => {
                            piece.addEventListener('dragstart', (e) => {
                                draggedPiece = piece;
                                playSound(sounds.buttonClick);
                                e.dataTransfer.setData('text/plain', piece.id);
                                setTimeout(() => piece.classList.add('dragging'), 0);
                            });

                            piece.addEventListener('dragend', () => {
                                piece.classList.remove('dragging');
                                draggedPiece = null;
                            });

                            piece.addEventListener('touchstart', (e) => {
                                draggedPiece = piece;
                                playSound(sounds.buttonClick);
                                piece.classList.add('dragging');
                            }, {passive: true});
                        });

                        const dropZones = [...allSlots, puzzlePool];

                        dropZones.forEach(zone => {
                            zone.addEventListener('dragover', (e) => {
                                e.preventDefault();
                                if (zone.classList.contains('puzzle-slot') && zone.children.length === 0) {
                                    zone.classList.add('drag-over');
                                } else if (zone.classList.contains('puzzle-pool')) {
                                    zone.style.backgroundColor = '#d1ecf1'; // Highlight pool
                                }
                            });

                            zone.addEventListener('dragleave', () => {
                                zone.classList.remove('drag-over');
                                if (zone.classList.contains('puzzle-pool')) {
                                    zone.style.backgroundColor = '#e0f2f7'; // Reset pool color
                                }
                            });

                            zone.addEventListener('drop', (e) => {
                                e.preventDefault();
                                zone.classList.remove('drag-over');
                                if (zone.classList.contains('puzzle-pool')) {
                                    zone.style.backgroundColor = '#e0f2f7';
                                }

                                const id = e.dataTransfer.getData('text/plain');
                                const piece = document.getElementById(id);
                                
                                if (piece) {
                                    handlePuzzleDrop(piece, zone);
                                }
                            });
                        });

                        playerContent.addEventListener('touchmove', (e) => {
                            if (!draggedPiece) return;
                            e.preventDefault();
                            
                            const touch = e.targetTouches[0];
                            const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
 
                            dropZones.forEach(dz => dz.classList.remove('drag-over'));

                            let targetZone = elementUnderTouch ? elementUnderTouch.closest('.puzzle-slot, .puzzle-pool') : null;
                            
                            if (targetZone) {
                                if (targetZone.classList.contains('puzzle-slot') && targetZone.children.length === 0) {
                                    targetZone.classList.add('drag-over');
                                }
                            }
                        }, {passive: false});

                        playerContent.addEventListener('touchend', (e) => {
                            if (!draggedPiece) return;
                            
                            const touch = e.changedTouches[0];
                            const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                            const targetZone = elementUnderTouch ? elementUnderTouch.closest('.puzzle-slot, .puzzle-pool') : null;
                            
                            if (targetZone) {
                                handlePuzzleDrop(draggedPiece, targetZone);
                            }

                            draggedPiece.classList.remove('dragging');
                            dropZones.forEach(dz => dz.classList.remove('drag-over'));
                            draggedPiece = null;
                        });

                        function handlePuzzleDrop(piece, targetZone) {
                            if (!levelInProgress) return;
                            
                            if (targetZone.classList.contains('puzzle-pool')) {
                                targetZone.appendChild(piece);
                                playSound(sounds.buttonHover); 
                            } else if (targetZone.classList.contains('puzzle-slot')) {
                                if (targetZone.children.length === 0) {
                                    targetZone.appendChild(piece);
                                    playSound(sounds.buttonHover); 
                                    checkPuzzleWin(playerNum);
                                } else {

                                    piece.classList.add('shake');
                                    setTimeout(() => piece.classList.remove('shake'), 300);
                                    playSound(sounds.wrong);
                                }
                            }
                        }

                        function checkPuzzleWin(pNum) {
                            const slots = puzzleBoard.querySelectorAll('.puzzle-slot');
                            let correctCount = 0;
                            let isComplete = true;

                            slots.forEach(slot => {
                                if (slot.children.length === 0) {
                                    isComplete = false;
                                    return;
                                }
                                const piece = slot.children[0];
                                const slotIndex = parseInt(slot.dataset.index);
                                const pieceIndex = parseInt(piece.dataset.correctIndex);
                                
                                if (slotIndex === pieceIndex) {
                                    correctCount++;
                                }
                            });
                            
                            if (isComplete) {
                                if (correctCount === 9) {

                                    playSound(sounds.correct);
                                    if (pNum === 1) p1Score += 5; else p2Score += 5; 
                                    updateScores();

                                    puzzleBoard.style.pointerEvents = 'none';
                                    puzzleBoard.style.borderColor = '#2ECC71';
                                    puzzleBoard.style.boxShadow = '0 0 15px #2ECC71';
                                }
                            }
                        }

                    } 

                    setupPlayerPuzzle(p1Content, 1);
                    setupPlayerPuzzle(p2Content, 2);
                }

                setupPlayerMemory(p1Content, 1);
                setupPlayerMemory(p2Content, 2);
            }

            // --- LOGIKA LEVEL 4: PUZZLE DRAG & DROP ---
            function setupLevel4() {
                function setupPlayerPuzzle(playerContent, playerNum) {
                    const randomSila = pancasilaItems[Math.floor(Math.random() * pancasilaItems.length)];
                    const imgSrc = randomSila.imgSrc;
                    const gridSize = 3; 

                    playerContent.innerHTML = `
                        <div class="puzzle-wrapper">
                            <p class="puzzle-reference">Susun menjadi gambar ini: <img src="${imgSrc}" alt="Target"></p>
                            <div class="puzzle-board" id="p${playerNum}-puzzle-board"></div>
                            <div class="puzzle-pool" id="p${playerNum}-puzzle-pool"></div>
                        </div>
                    `;
                    
                    const puzzleBoard = document.getElementById(`p${playerNum}-puzzle-board`);
                    const puzzlePool = document.getElementById(`p${playerNum}-puzzle-pool`);
                    
                    // 1. Create Board Slots
                    for (let i = 0; i < gridSize * gridSize; i++) {
                        const slot = document.createElement('div');
                        slot.classList.add('puzzle-slot');
                        slot.dataset.index = i;
                        puzzleBoard.appendChild(slot);
                    }

                    // 2. Create Puzzle Pieces
                    let pieces = [];
                    for (let row = 0; row < gridSize; row++) {
                        for (let col = 0; col < gridSize; col++) {
                            const index = row * gridSize + col;
                            pieces.push({
                                correctIndex: index,
                                bgPosX: col * 100 / (gridSize - 1),
                                bgPosY: row * 100 / (gridSize - 1)
                            });
                        }
                    }
                    
                    // 3. Shuffle and Place in Pool
                    let shuffledPieces = [...pieces].sort(() => Math.random() - 0.5);
                    
                    shuffledPieces.forEach((pieceData, i) => {
                        const piece = document.createElement('div');
                        piece.classList.add('puzzle-piece-draggable');
                        piece.style.backgroundImage = `url('${imgSrc}')`;
                        piece.style.backgroundPosition = `${pieceData.bgPosX}% ${pieceData.bgPosY}%`;
                        piece.dataset.correctIndex = pieceData.correctIndex;
                        piece.draggable = true;
                        piece.id = `p${playerNum}-piece-${i}`; 
                        puzzlePool.appendChild(piece);
                        addHoverSound(piece);
                    });

                    // 4. Add Drag and Drop Logic
                    let draggedPiece = null;
                    const allPieces = playerContent.querySelectorAll('.puzzle-piece-draggable');
                    const allSlots = playerContent.querySelectorAll('.puzzle-slot');

                    // Draggable Events
                    allPieces.forEach(piece => {
                        piece.addEventListener('dragstart', (e) => {
                            draggedPiece = piece;
                            playSound(sounds.buttonClick);
                            e.dataTransfer.setData('text/plain', piece.id);
                            setTimeout(() => piece.classList.add('dragging'), 0);
                        });

                        piece.addEventListener('dragend', () => {
                            piece.classList.remove('dragging');
                            draggedPiece = null;
                        });

                        // Touch start
                        piece.addEventListener('touchstart', (e) => {
                            draggedPiece = piece;
                            playSound(sounds.buttonClick);
                            piece.classList.add('dragging');
                        }, {passive: true});
                    });

                    // Drop Zone Events (Slots & Pool)
                    const dropZones = [...allSlots, puzzlePool];

                    dropZones.forEach(zone => {
                        zone.addEventListener('dragover', (e) => {
                            e.preventDefault();
                            if (zone.classList.contains('puzzle-slot') && zone.children.length === 0) {
                                zone.classList.add('drag-over');
                            } else if (zone.classList.contains('puzzle-pool')) {
                                zone.style.backgroundColor = '#d1ecf1'; // Highlight pool
                            }
                        });

                        zone.addEventListener('dragleave', () => {
                            zone.classList.remove('drag-over');
                            if (zone.classList.contains('puzzle-pool')) {
                                zone.style.backgroundColor = '#e0f2f7'; // Reset pool color
                            }
                        });

                        zone.addEventListener('drop', (e) => {
                            e.preventDefault();
                            zone.classList.remove('drag-over');
                            if (zone.classList.contains('puzzle-pool')) {
                                zone.style.backgroundColor = '#e0f2f7';
                            }

                            const id = e.dataTransfer.getData('text/plain');
                            const piece = document.getElementById(id);
                            
                            if (piece) {
                                handlePuzzleDrop(piece, zone);
                            }
                        });
                    });

                    // Touch Events (Move & End) for the whole area
                    playerContent.addEventListener('touchmove', (e) => {
                        if (!draggedPiece) return;
                        e.preventDefault();
                        
                        const touch = e.targetTouches[0];
                        const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                        
                        // Highlight potential drop zone
                        dropZones.forEach(dz => dz.classList.remove('drag-over'));
                        
                        // Find closest drop zone (slot or pool)
                        let targetZone = elementUnderTouch ? elementUnderTouch.closest('.puzzle-slot, .puzzle-pool') : null;
                        
                        if (targetZone) {
                            if (targetZone.classList.contains('puzzle-slot') && targetZone.children.length === 0) {
                                targetZone.classList.add('drag-over');
                            }
                        }
                    }, {passive: false});

                    playerContent.addEventListener('touchend', (e) => {
                        if (!draggedPiece) return;
                        
                        const touch = e.changedTouches[0];
                        const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                        const targetZone = elementUnderTouch ? elementUnderTouch.closest('.puzzle-slot, .puzzle-pool') : null;
                        
                        if (targetZone) {
                            handlePuzzleDrop(draggedPiece, targetZone);
                        }

                        draggedPiece.classList.remove('dragging');
                        dropZones.forEach(dz => dz.classList.remove('drag-over'));
                        draggedPiece = null;
                    });

                    function handlePuzzleDrop(piece, targetZone) {
                        if (!levelInProgress) return;
                        
                        if (targetZone.classList.contains('puzzle-pool')) {
                            targetZone.appendChild(piece);
                            playSound(sounds.buttonHover); // Suara letak
                        } else if (targetZone.classList.contains('puzzle-slot')) {
                            if (targetZone.children.length === 0) {
                                targetZone.appendChild(piece);
                                playSound(sounds.buttonHover); // Suara letak
                                checkPuzzleWin(playerNum);
                            } else {
                                // Slot penuh, kembalikan efek visual tolak (shake)
                                piece.classList.add('shake');
                                setTimeout(() => piece.classList.remove('shake'), 300);
                                playSound(sounds.wrong);
                            }
                        }
                    }

                    function checkPuzzleWin(pNum) {
                        const slots = puzzleBoard.querySelectorAll('.puzzle-slot');
                        let correctCount = 0;
                        let isComplete = true;

                        slots.forEach(slot => {
                            if (slot.children.length === 0) {
                                isComplete = false;
                                return;
                            }
                            const piece = slot.children[0];
                            const slotIndex = parseInt(slot.dataset.index);
                            const pieceIndex = parseInt(piece.dataset.correctIndex);
                            
                            if (slotIndex === pieceIndex) {
                                correctCount++;
                            }
                        });
                        
                        // Jika semua slot terisi
                        if (isComplete) {
                            if (correctCount === 9) {
                                // Menang
                                playSound(sounds.correct);
                                if (pNum === 1) p1Score += 5; else p2Score += 5; // Poin besar untuk puzzle
                                updateScores();

                                puzzleBoard.style.pointerEvents = 'none';
                                puzzleBoard.style.borderColor = '#2ECC71';
                                puzzleBoard.style.boxShadow = '0 0 15px #2ECC71';
                            }
                        }
                    }

                } 

                setupPlayerPuzzle(p1Content, 1);
                setupPlayerPuzzle(p2Content, 2);
            }


            function showFinalScreen() {
				playSound(sounds.victory);
                switchScreen('final');
                document.getElementById('final-p1-wins').textContent = p1Wins;
                document.getElementById('final-p2-wins').textContent = p2Wins;

                const winnerEl = document.getElementById('overall-winner');
                if (p1Wins > p2Wins) {
                    winnerEl.textContent = 'Pemenang Keseluruhan adalah Pemain 1!';
                    startVictoryAnimation('p1-win'); 
                } else if (p2Wins > p1Wins) {
                    winnerEl.textContent = 'Pemenang Keseluruhan adalah Pemain 2!';
                    startVictoryAnimation('p2-win'); 
                } else {
                    winnerEl.textContent = 'Permainan Berakhir Seri!';
                }
            }

            init();
        });
    </script>
    <script>
    window.addEventListener("load", () => {
    const audio = document.getElementById("autoSound");
    audio.volume = 1.0;
    audio.play().catch(() => {
    console.log("Autoplay dicegah, menunggu interaksi user...");
    });
    });
    </script>

</body>
</html>
